<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãµã‚ãµã‚ã¨ã‚‚ã ã¡ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
            padding: 10px;
            overflow: hidden;
            margin: 0;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ç”¨ã®èƒŒæ™¯ */
        body.title-background {
            background-image: url('images/title-background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

       /* ãã®ä»–ã®ç”»é¢ç”¨ã®èƒŒæ™¯ */
        body.game-background {
            background-image: url('images/game-background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ã‚¿ã‚¤ãƒˆãƒ«èƒŒæ™¯ï¼ˆ16:9å¯¾å¿œï¼‰ */
        @media (min-width: 769px) {
            body.title-background {
                background-image: url('images/title-background-desktop.png');
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
                background-attachment: fixed;
            }
            
            body.game-background {
                background-image: url('images/game-background-desktop.png');
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
            }
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 100%;
            padding: 20px;
            text-align: center;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã§ã¯ç™½ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’éè¡¨ç¤º */
        body.title-background .game-container {
            background: transparent;
            box-shadow: none;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }

        h2 {
            color: #555;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 25px;
            margin: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            min-width: 120px;
            touch-action: manipulation;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .button:active {
            transform: translateY(0);
        }

        .difficulty-buttons .button {
            display: block;
            width: 100%;
            margin: 10px auto;
        }

        .difficulty-buttons .button.easy { 
            background: linear-gradient(45deg, #2ecc71, #27ae60); 
        }
        
        .difficulty-buttons .button.normal { 
            background: linear-gradient(45deg, #3498db, #2980b9); 
        }

        .difficulty-buttons .button.hard { 
            background: linear-gradient(45deg, #f39c12, #e67e22); 
        }

        .difficulty-buttons .button.oni { 
            background: linear-gradient(45deg, #e74c3c, #c0392b); 
        }

        .difficulty-buttons .button.choyaba { 
            background: linear-gradient(45deg, #8e44ad, #7d3c98);
            animation: rainbow 2s linear infinite;
        }

        @keyframes rainbow {
            0% { background: linear-gradient(45deg, #e74c3c, #f39c12); }
            25% { background: linear-gradient(45deg, #f39c12, #2ecc71); }
            50% { background: linear-gradient(45deg, #2ecc71, #3498db); }
            75% { background: linear-gradient(45deg, #3498db, #9b59b6); }
            100% { background: linear-gradient(45deg, #9b59b6, #e74c3c); }
        }

        .puzzle-container {
            margin: 20px auto;
            display: inline-block;
            border: 3px solid #333;
            border-radius: 10px;
            overflow: hidden;
            background: #f0f0f0;
            max-width: 100%;
            box-sizing: border-box;
        }

        .puzzle-grid {
            display: grid;
            gap: 1px;
            background: #333;
            padding: 1px;
            max-width: 100%;
            overflow: hidden;
        }

        .puzzle-piece {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            position: relative;
            touch-action: manipulation;
        }

        .puzzle-piece:hover {
            border-color: #ff6b6b;
        }

        .puzzle-piece.empty {
            background: #ddd;
            cursor: default;
        }

        .puzzle-piece.empty:hover {
            border-color: transparent;
        }

        .moves-counter {
            margin: 10px 0;
            font-size: 18px;
            color: #333;
            font-weight: bold;
        }

        .picture-select {
            margin: 20px 0;
            max-height: 200px;
            overflow-x: scroll;
            overflow-y: hidden;
            padding: 10px 5px;
            display: grid;
            grid-template-rows: repeat(2, 85px);
            grid-auto-flow: column;
            gap: 10px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            justify-content: start;
        }

        /* å³ç«¯ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã‚’ç¤ºã™ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ¡ä»¶ä»˜ãè¡¨ç¤ºï¼‰ */
        .picture-select.has-more::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 30px;
            height: 100%;
            background: linear-gradient(to left, rgba(255,255,255,0.8), transparent);
            pointer-events: none;
            z-index: 5;
        }
        
        .picture-select {
            position: relative;
            z-index: 1;
        }
        

        .picture-option {
            display: inline-block;
            width: 80px;
            height: 80px;
            min-width: 80px;
            border: 3px solid transparent;
            border-radius: 10px;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
            flex-shrink: 0;
            position: relative;
            z-index: 2;
        }

        .picture-option:hover, .picture-option.selected {
            border-color: #ff6b6b;
            transform: scale(1.05);
        }

        /* ã‚¯ãƒªã‚¢æ¸ˆã¿çµµæŸ„ã®â˜…ãƒãƒ¼ã‚¯ */
        .picture-option.cleared::before {
            content: 'â­';
            position: absolute;
            top: -2px;
            right: 5px;
            font-size: 16px;
            z-index: 10;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .congratulations {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            align-items: center;
        }
        
        .picture-title {
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .new-unlock-message {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* æ–°ã—ã„ç´™å¹é›ªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¸­å¿ƒã‹ã‚‰å¼¾ã‘ã‚‹ï¼‰ */
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .confetti:nth-child(2n) { 
            background: #3498db; 
            animation: explode1 2s ease-out forwards;
        }
        .confetti:nth-child(3n) { 
            background: #2ecc71; 
            animation: explode2 2.2s ease-out forwards;
        }
        .confetti:nth-child(4n) { 
            background: #f39c12; 
            animation: explode3 1.8s ease-out forwards;
        }
        .confetti:nth-child(5n) { 
            background: #9b59b6; 
            animation: explode4 2.1s ease-out forwards;
        }
        .confetti:nth-child(6n) { 
            background: #e74c3c; 
            animation: explode5 1.9s ease-out forwards;
        }
        
        @keyframes explode1 {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            15% { transform: translate(-30px, -80px) scale(1) rotate(180deg); opacity: 1; }
            100% { transform: translate(-60px, 100px) scale(0.3) rotate(720deg); opacity: 0; }
        }
        
        @keyframes explode2 {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            15% { transform: translate(40px, -60px) scale(1) rotate(-180deg); opacity: 1; }
            100% { transform: translate(120px, 80px) scale(0.3) rotate(-720deg); opacity: 0; }
        }
        
        @keyframes explode3 {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            15% { transform: translate(-70px, 30px) scale(1) rotate(270deg); opacity: 1; }
            100% { transform: translate(-140px, 90px) scale(0.3) rotate(900deg); opacity: 0; }
        }
        
        @keyframes explode4 {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            15% { transform: translate(50px, 40px) scale(1) rotate(-270deg); opacity: 1; }
            100% { transform: translate(100px, 120px) scale(0.3) rotate(-900deg); opacity: 0; }
        }
        
        @keyframes explode5 {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            15% { transform: translate(0px, -90px) scale(1) rotate(360deg); opacity: 1; }
            100% { transform: translate(0px, -180px) scale(0.3) rotate(1080deg); opacity: 0; }
        }
        .back-button {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            margin-top: 15px;
        }

        .game-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
            font-weight: bold;
        }
        
        .subtitle {
            color: #555;
            font-size: 14px;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
            font-weight: bold;
        }

        .loading-message {
            color: #666;
            font-style: italic;
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        .title-content {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
        }

        .start-game-button {
            font-size: 20px;
            padding: 20px 40px;
            min-width: 200px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        @media (max-width: 480px) {
            .game-container {
                padding: 10px;
                max-width: 95vw;
            }
            
            h1, .game-title {
                font-size: 20px;
            }
            
            h2 {
                font-size: 18px;
            }
            
            .button {
                padding: 10px 15px;
                font-size: 14px;
                margin: 5px;
            }
            
            .moves-counter {
                font-size: 16px;
            }
            
            .puzzle-container {
                margin: 10px auto;
                border: 2px solid #333;
            }
            
            .puzzle-grid {
                gap: 1px;
                padding: 1px;
            }

            .picture-select {
                max-height: 150px;
                padding: 5px;
                gap: 8px;
                max-width: 100%;
                justify-content: flex-start;
            }
            
            .picture-option {
                width: 85px;
                height: 85px;
                min-width: 85px;
            }
        }

        /* ã‚¹ãƒãƒ›ã§ã®çµµæŸ„è¡¨ç¤ºèª¿æ•´ï¼ˆ2è¡ŒÃ—3åˆ—ã€å³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰ */
        @media (max-width: 480px) {
            .picture-select {
                width: calc(85px * 3 + 10px * 2 + 20px);
                max-height: 190px;
                margin: 20px auto;
                grid-template-rows: repeat(2, 85px);
                grid-template-columns: repeat(3, 85px);
                grid-auto-flow: column;
                overflow-x: scroll;
                overflow-y: hidden;
                justify-content: start;
            }
            
            .picture-option {
                width: 85px;
                height: 85px;
            }
        }

        @media (max-width: 360px) {
            .game-container {
                padding: 8px;
                max-width: 98vw;
            }
            
            .button {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            h1, .game-title {
                font-size: 18px;
            }
            
            .picture-select {
                width: calc(75px * 3 + 6px * 2 + 8px);
            }
            
            .picture-option {
                width: 75px;
                height: 75px;
                min-width: 75px;
            }
        }
        /* å®Œæˆã‚¤ãƒ©ã‚¹ãƒˆè¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .completed-image {
            width: 150px;
            height: 150px;
            border: 3px solid #fff;
            border-radius: 10px;
            margin: 15px auto;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: block;
            flex-shrink: 0;
            position: relative;
            z-index: 10;
        }
        
        .thank-you-message {
    background: rgba(255, 255, 255, 0.2);
    padding: 10px;
    border-radius: 8px;
    margin: 10px 0;
    font-size: 14px;
    line-height: 1.4;
}

/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
.picture-select {
    scrollbar-width: auto; /* Firefoxç”¨ */
}
    
/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
.picture-select {
    scrollbar-width: auto; /* Firefoxç”¨ */
}
        
        .picture-select::-webkit-scrollbar {
            height: 14px;
            display: block;
        }
        
        .picture-select::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
            border: 1px solid #ccc;
        }
        
        .picture-select::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #ff6b6b, #3498db);
            border-radius: 10px;
            border: 1px solid #999;
            min-width: 20px;
        }
        
        .picture-select::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #e55555, #2980b9);
        }
        
        .picture-select::-webkit-scrollbar-corner {
            background: transparent;
        }
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
        <div id="title-screen" class="screen active">
            <div class="loading-message" id="loading-message">ç”»åƒã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            <div class="title-content">
                <button class="button start-game-button" id="start-button" onclick="goToPictureSelect()" style="display: none;">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            </div>
        </div>

        <!-- çµµæŸ„é¸æŠç”»é¢ -->
        <div id="picture-select-screen" class="screen">
            <h2>çµµæŸ„ã‚’é¸ã¼ã†ï¼</h2>
            <div class="picture-select" id="picture-options">
                <div class="picture-option selected" onclick="selectPicture(0)" data-picture="0"></div>
            </div>
            <button class="button" onclick="goToDifficultySelect()">ã“ã®çµµæŸ„ã§éŠã¶</button>
            <button class="button back-button" onclick="goToTitle()">æˆ»ã‚‹</button>
        </div>

        <!-- é›£æ˜“åº¦é¸æŠç”»é¢ -->
        <div id="difficulty-select-screen" class="screen">
            <h2>é›£æ˜“åº¦ã‚’é¸ã¼ã†ï¼</h2>
            <div class="difficulty-buttons">
                <button class="button easy" onclick="startGame(3)">ã‹ã‚“ãŸã‚“ (3Ã—3)</button>
                <button class="button normal" onclick="startGame(4)">ãµã¤ã† (4Ã—4)</button>
                <button class="button hard" onclick="startGame(5)">ã‚€ãšã„ (5Ã—5)</button>
                <button class="button oni" onclick="startGame(9)">ãŠã« (9Ã—9)</button>
                <button class="button choyaba" onclick="startGame(11)">ã¡ã‚‡ãƒ¼ãƒ¤ãƒ (11Ã—11)</button>
            </div>
            <button class="button back-button" onclick="goToPictureSelect()">æˆ»ã‚‹</button>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div id="game-screen" class="screen">
            <h2>ãƒ‘ã‚ºãƒ«ã‚’è§£ã„ã¦ã­ï¼</h2>
            <div class="moves-counter">å‹•ã‹ã—ãŸå›æ•°: <span id="moves">0</span></div>
            <div class="puzzle-container">
                <div id="puzzle-grid" class="puzzle-grid"></div>
            </div>
            <button class="button back-button" onclick="goToDifficultySelect()">é›£æ˜“åº¦é¸æŠã«æˆ»ã‚‹</button>
        </div>

        <!-- ã‚¯ãƒªã‚¢ç”»é¢ -->
        <div id="clear-screen" class="screen">
            <div class="congratulations" id="congratulations-container">
                <h2>ğŸ‰ ãŠã‚ã§ã¨ã†ï¼ ğŸ‰</h2>
                <p>ãƒ‘ã‚ºãƒ«ã‚¯ãƒªã‚¢ï¼</p>
                <div class="picture-title" id="picture-title"></div>
                
                <!-- å®Œæˆã‚¤ãƒ©ã‚¹ãƒˆè¡¨ç¤º -->
                <div class="completed-image" id="completed-image"></div>
                
                <!-- æ„Ÿè¬ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                <div class="thank-you-message" id="thank-you-message"></div>
                
                <p><span id="final-moves"></span>å›ã§å®Œæˆã•ã›ã¾ã—ãŸ</p>
            </div>
            <!-- ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤ï¼ˆå…¨çµµæŸ„ãŒæœ€åˆã‹ã‚‰åˆ©ç”¨å¯èƒ½ï¼‰ -->
            <button class="button" onclick="goToPictureSelect()">æ¬¡ã®ãƒ‘ã‚ºãƒ«ã«æŒ‘æˆ¦</button>
            <button class="button back-button" onclick="goToTitle()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let currentPicture = 0;
        let currentSize = 3;
        let moves = 0;
        let puzzleGrid = [];
        let gameImages = [];
        let imagesLoaded = false;
        let unlockedPictures = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]; // â† 12 ã‚’è¿½åŠ 
        let clearedStages = []; // ã‚¯ãƒªã‚¢ã—ãŸã‚¹ãƒ†ãƒ¼ã‚¸æƒ…å ±
        
        // âœï¸ ç”»åƒã®è©³ç´°æƒ…å ±ï¼ˆæä¾›è€…ã¨ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
        // ã“ã“ã‚’ç·¨é›†ã—ã¦å†™çœŸæä¾›è€…æƒ…å ±ã¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤‰æ›´ã§ãã¾ã™
        const imageDetails = [
            // 001.png ã®æƒ…å ±
            {
                type: 'original',  // ã‚ãã‚‰ã¡ã‚ƒã‚“ä½œæˆã®å ´åˆã¯ 'original'
                message: 'å…¬åœ’ã§ã‚ãã‚“ã ã‚ˆï¼'
            },
            // 002.png ã®æƒ…å ±
            {
                type: 'friend',     // ãŠå‹é”æä¾›ã®å ´åˆã¯ 'friend' ã«å¤‰æ›´
                provider: 'ã‚†ã‚ã¯ãª', // â† ã“ã“ã«æä¾›è€…åã‚’å…¥åŠ›
                message: 'ã¶ã©ã†ç‹©ã‚Šã«è¡Œã£ã¦ããŸã‚ˆï¼'  // â† ã“ã“ãŒã‚³ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™
            },
            // 003.png ã®æƒ…å ±
            {
                type: 'friend',     // ãŠå‹é”æä¾›
                provider: 'Arumax', // â† ã“ã“ã«æä¾›è€…åã‚’å…¥åŠ›
                message: 'ã‚¦ãƒ«ãƒˆãƒ©ãƒãƒ³å‚ä¸Šï¼'  // â† ã“ã“ãŒã‚³ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™
            },
            // 004.png ã®æƒ…å ±
            {
                type: 'original',     // ã‚ãã‚‰
                message: 'ã‚ã°ã‚Œç¥­ã€ã„ã£ã¦ããŸã‚ˆï¼'  // â† ã“ã“ãŒã‚³ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™
            },
            // 005.png ã®æƒ…å ±
            {
                type: 'original',     // ãŠå‹é”æä¾›
                message: 'ã‚ã„ã‚ã„ç¥­ã‚Šã€ãŸã®ã—ã‹ã£ãŸã­ï¼'  // â† ã“ã“ãŒã‚³ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™
            },
           // 006.png ã®æƒ…å ±
            {
                type: 'friend',     // ãŠå‹é”æä¾›
                provider: 'ã¾ã»ã¡ã‚ƒã‚“', // â† ã“ã“ã«æä¾›è€…åã‚’å…¥åŠ›
                message: 'ã‚„ããƒã‚·ãƒ¥ãƒãƒ­ã€ãŠã„ã—ãƒ¼ã‚ˆï¼'  // â† ã“ã“ãŒã‚³ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™
            },
            // 007.png ã®æƒ…å ±
            {
                type: 'friend',     // ãŠå‹é”æä¾›
                provider: 'ã¨ã†ã”ãã‚“', // â† ã“ã“ã«æä¾›è€…åã‚’å…¥åŠ›
                message: 'ã‚µãƒƒã‚«ãƒ¼ãªã‹ã¾'  // â† ã“ã“ãŒã‚³ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™
            },
            // 008.png ã®æƒ…å ±
            {
                type: 'friend',     // ãŠå‹é”æä¾›
                provider: 'ã‚†ã‚Šã¡ã‚ƒã‚“', // â† ã“ã“ã«æä¾›è€…åã‚’å…¥åŠ›
                message: 'ãŸã„ã›ã¤ãªæ„›çŠ¬ï¼'  // â† ã“ã“ãŒã‚³ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™
            },
            // 009.png ã®æƒ…å ±
            {
                type: 'friend',     // ãŠå‹é”æä¾›
                provider: 'ã“ã“ã­ã¡ã‚ƒã‚“', // â† ã“ã“ã«æä¾›è€…åã‚’å…¥åŠ›
                message: 'å§‰å¦¹ã§ã«ã£ã“ã‚Š'  // â† ã“ã“ãŒã‚³ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™
            },
            // 010.png ã®æƒ…å ±
            {
                type: 'friend',
                provider: 'ã¿ãªã—ãŠ',
                message: 'å§‰å¦¹ã§ãƒ”ãƒ¼ã‚¹ï¼'
            }, // â† ã“ã®ã‚«ãƒ³ãƒãŒå¿…è¦
            // 011.png ã®æƒ…å ±
        {
                type: 'original',     // ãŠå‹é”æä¾›
                message: 'è¶…ãã‚‡ã†ã¼ã†ãªçŒ«ãƒ»ã¿ã¿'  // â† ã“ã“ãŒã‚³ãƒ¡ãƒ³ãƒˆã«ãªã‚Šã¾ã™
        },  // â† ã‚«ãƒ³ãƒå¿˜ã‚Œãšã«
           // 012.png ã®æƒ…å ±
        {
            type: 'friend',
            provider: 'ã‘ã„ãã‚“',
            message: 'ãã†ã“ã†ã§ãƒ”ã‚«ãƒãƒ¥ã‚¦ã¨ï¼'
        },  // â† ã‚«ãƒ³ãƒå¿˜ã‚Œãšã«
        // 013.png ã®æƒ…å ±
{
    type: 'friend',
    provider: 'ãªãªã¡ã‚ƒã‚“',
    message: 'ã‚¤ã‚§ãƒ¼ã‚¤â˜†'
}
];  // â† ã“ã®é–‰ã˜æ‹¬å¼§ã¨ã‚»ãƒŸã‚³ãƒ­ãƒ³ãŒå¿…è¦
        
        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // èƒŒæ™¯ç”»åƒã®åˆ‡ã‚Šæ›¿ãˆ
            const body = document.body;
            body.classList.remove('title-background', 'game-background');
            
            if (screenId === 'title-screen') {
                body.classList.add('title-background');
            } else {
                body.classList.add('game-background');
            }
        }

        function goToTitle() {
            showScreen('title-screen');
        }

        function goToPictureSelect() {
            if (!imagesLoaded) {
                alert('ç”»åƒã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚');
                return;
            }
            updatePictureOptions();
            showScreen('picture-select-screen');
        }

        function goToDifficultySelect() {
            showScreen('difficulty-select-screen');
        }

        // çµµæŸ„é¸æŠ
        function selectPicture(index) {
            currentPicture = index;
            document.querySelectorAll('.picture-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`[data-picture="${index}"]`).classList.add('selected');
        }

        function updatePictureOptions() {
            const container = document.getElementById('picture-options');
            container.innerHTML = '';
            
            // ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸç”»åƒã®ã¿è¡¨ç¤º
            unlockedPictures.forEach((pictureIndex, displayIndex) => {
                if (gameImages[pictureIndex]) {
                    const option = document.createElement('div');
                    option.className = 'picture-option' + (displayIndex === 0 ? ' selected' : '');
                    option.style.backgroundImage = `url(${gameImages[pictureIndex]})`;
                    option.setAttribute('data-picture', pictureIndex.toString());
                    option.onclick = () => selectPicture(pictureIndex);
                    
                    // ãƒ›ãƒãƒ¼æ™‚ã®è¡¨ç¤º
                    option.title = `ç”»åƒ ${pictureIndex + 1}`;
                    
                    // ã‚¯ãƒªã‚¢æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯ã—ã¦â˜…ãƒãƒ¼ã‚¯è¿½åŠ 
                    const isCleared = clearedStages.some(stage => stage.startsWith(`${pictureIndex}-`));
                    if (isCleared) {
                        option.classList.add('cleared');
                    }
                    
                    container.appendChild(option);
                }
            });
            
            // ç¾åœ¨é¸æŠä¸­ã®çµµæŸ„ã‚’æ›´æ–°
            if (unlockedPictures.includes(currentPicture)) {
                selectPicture(currentPicture);
            } else {
                selectPicture(unlockedPictures[0]);
            }
            // ã‚¹ãƒãƒ›ç”¨ï¼šå³çŸ¢å°ã®è¡¨ç¤ºåˆ¶å¾¡ã¨ã‚³ãƒ³ãƒ†ãƒŠå¹…èª¿æ•´
            const pictureContainer = document.getElementById('picture-options');
            setTimeout(() => {
                // çµµæŸ„æ•°ã«å¿œã˜ã¦ã‚³ãƒ³ãƒ†ãƒŠå¹…ã‚’å‹•çš„èª¿æ•´ï¼ˆ3åˆ—2è¡Œï¼‹å³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰
                const totalPictures = unlockedPictures.filter(index => gameImages[index]).length;
                
                if (window.innerWidth <= 480) {
                    // 3åˆ—å›ºå®šã€å¿…è¦ã«å¿œã˜ã¦å³ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    const containerWidth = 85 * 3 + 10 * 2 + 20;
                    pictureContainer.style.width = `${containerWidth}px`;
                    pictureContainer.style.maxHeight = '190px';
                    
                    // 7æšä»¥ä¸Šã®å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½
                    if (totalPictures > 6) {
                        pictureContainer.style.gridTemplateColumns = `repeat(${Math.ceil(totalPictures / 2)}, 85px)`;
                    } else {
                        pictureContainer.style.gridTemplateColumns = 'repeat(3, 85px)';
                    }
                }
                
                const hasMore = pictureContainer.scrollWidth > pictureContainer.clientWidth;
                if (hasMore && totalPictures > 6) {
                    pictureContainer.classList.add('has-more');
                } else {
                    pictureContainer.classList.remove('has-more');
                }
                
                // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã«çŸ¢å°ã‚’éè¡¨ç¤º
                pictureContainer.addEventListener('scroll', () => {
                    if (pictureContainer.scrollLeft > 0) {
                        pictureContainer.classList.remove('has-more');
                    }
                });
            }, 100);
        }

        // ğŸ†• ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒã‚’èª­ã¿è¾¼ã‚€ï¼ˆ10å€‹å¯¾å¿œï¼‰
        function loadLocalImages() {
            const imagePaths = [
    'images/001.png',
    'images/002.png',
    'images/003.png',
    'images/004.png',
    'images/005.png',
    'images/006.png',
    'images/007.png',
    'images/008.png',
    'images/009.png',
    'images/010.png',
    'images/011.png',
    'images/012.png',
    'images/013.png'  // â† è¿½åŠ 
];

            let loadedCount = 0;
            const totalImages = imagePaths.length;

            imagePaths.forEach((path, index) => {
                const img = new Image();
                
                img.onload = function() {
                    // ç”»åƒã‚’æ­£æ–¹å½¢ã«ãƒªã‚µã‚¤ã‚º
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 400;
                    canvas.height = 400;
                    
                    const minSize = Math.min(img.width, img.height);
                    const startX = (img.width - minSize) / 2;
                    const startY = (img.height - minSize) / 2;
                    
                    ctx.drawImage(img, startX, startY, minSize, minSize, 0, 0, 400, 400);
                    
                    gameImages[index] = canvas.toDataURL();
                    loadedCount++;
                    
                    console.log(`ç”»åƒ ${index + 1}/${totalImages} èª­ã¿è¾¼ã¿å®Œäº†: ${path}`);
                    
                    if (loadedCount === totalImages) {
                        onAllImagesLoaded();
                    }
                };
                
                img.onerror = function() {
                    console.log(`ç”»åƒèª­ã¿è¾¼ã¿å¤±æ•—: ${path} - ã‚µãƒ³ãƒ—ãƒ«ç”»åƒã§ä»£æ›¿`);
                    // ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ã‚µãƒ³ãƒ—ãƒ«ç”»åƒã‚’ä½œæˆ
                    gameImages[index] = createSampleImage(index);
                    loadedCount++;
                    
                    if (loadedCount === totalImages) {
                        onAllImagesLoaded();
                    }
                };
                
                img.src = path;
            });
        }

        function onAllImagesLoaded() {
            imagesLoaded = true;
            document.getElementById('loading-message').style.display = 'none';
            document.getElementById('start-button').style.display = 'inline-block';
            console.log('ã™ã¹ã¦ã®ç”»åƒã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
            console.log('ã‚¢ãƒ³ãƒ­ãƒƒã‚¯æ¸ˆã¿çµµæŸ„:', unlockedPictures);
        }

        // ã‚µãƒ³ãƒ—ãƒ«ç”»åƒã‚’ä½œæˆï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
        function createSampleImage(index) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 300;
            canvas.height = 300;
            
            // å„ç”»åƒã”ã¨ã«ç•°ãªã‚‹è‰²ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            const colors = [
                ['#ff6b6b', '#3498db', '#2ecc71'],  // 001
                ['#9b59b6', '#e74c3c', '#f39c12'],  // 002
                ['#1abc9c', '#34495e', '#e67e22'],  // 003
                ['#f39c12', '#27ae60', '#2980b9'],  // 004
                ['#8e44ad', '#16a085', '#f1c40f'],  // 005
                ['#e74c3c', '#2ecc71', '#3498db'],  // 006
                ['#95a5a6', '#e67e22', '#9b59b6'],  // 007
                ['#2c3e50', '#f39c12', '#27ae60'],  // 008
                ['#d35400', '#2980b9', '#8e44ad'],  // 009
                ['#c0392b', '#16a085', '#f1c40f']   // 010
            ];
            
            const colorSet = colors[index] || colors[0];
            const gradient = ctx.createLinearGradient(0, 0, 300, 300);
            gradient.addColorStop(0, colorSet[0]);
            gradient.addColorStop(0.5, colorSet[1]);
            gradient.addColorStop(1, colorSet[2]);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 300, 300);
            
            // å›³å½¢ã‚’è¿½åŠ 
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.arc(80, 80, 30, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.beginPath();
            ctx.arc(220, 80, 40, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
            ctx.beginPath();
            ctx.arc(150, 220, 50, 0, Math.PI * 2);
            ctx.fill();
            
            // ãƒ†ã‚­ã‚¹ãƒˆ
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(`ç”»åƒ${index + 1}`, 150, 150);
            
            return canvas.toDataURL();
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame(size) {
            currentSize = size;
            moves = 0;
            document.getElementById('moves').textContent = moves;
            initializePuzzle();
            showScreen('game-screen');
        }

        // ãƒ‘ã‚ºãƒ«åˆæœŸåŒ–
        function initializePuzzle() {
            const container = document.getElementById('puzzle-grid');
            
            // ç”»é¢ã‚µã‚¤ã‚ºã¨ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è€ƒæ…®ã—ã¦ãƒ‘ã‚ºãƒ«ã‚µã‚¤ã‚ºã‚’èª¿æ•´
            const containerPadding = 60; // ã‚³ãƒ³ãƒ†ãƒŠã®ä½™ç™½
            const screenWidth = window.innerWidth - containerPadding;
            const screenHeight = window.innerHeight - 300; // UIè¦ç´ åˆ†ã‚’é™¤ã
            
            let maxSize;
            if (currentSize <= 4) {
                maxSize = Math.min(screenWidth * 0.85, screenHeight * 0.7, 320);
            } else if (currentSize <= 6) {
                maxSize = Math.min(screenWidth * 0.90, screenHeight * 0.75, 360);
            } else if (currentSize <= 9) {
                maxSize = Math.min(screenWidth * 0.95, screenHeight * 0.8, 380);
            } else {
                // ã¡ã‚‡ãƒ¼ãƒ¤ãƒã¯ç‰¹ã«å°ã•ã
                maxSize = Math.min(screenWidth * 0.98, screenHeight * 0.85, 400);
            }
            
            const pieceSize = Math.floor(maxSize / currentSize);
            
            container.style.gridTemplateColumns = `repeat(${currentSize}, ${pieceSize}px)`;
            container.innerHTML = '';
            
            // ãƒ‘ã‚ºãƒ«ãƒ”ãƒ¼ã‚¹ã®é…åˆ—ã‚’ä½œæˆ
            puzzleGrid = [];
            for (let i = 0; i < currentSize * currentSize - 1; i++) {
                puzzleGrid.push(i);
            }
            puzzleGrid.push(null); // ç©ºã®ãƒ”ãƒ¼ã‚¹
            
            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆå¤§ããªãƒ‘ã‚ºãƒ«ã»ã©å¤šãã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼‰
            shufflePuzzle();
            
            // DOMè¦ç´ ã‚’ä½œæˆ
            renderPuzzle(pieceSize);
        }

        function shufflePuzzle() {
            // è§£ã‘ã‚‹çŠ¶æ…‹ã‚’ä¿è¨¼ã™ã‚‹ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆé›£æ˜“åº¦ã«å¿œã˜ã¦èª¿æ•´ï¼‰
            let shuffleCount;
            if (currentSize <= 4) {
                shuffleCount = 1000;
            } else if (currentSize <= 6) {
                shuffleCount = 2000;
            } else if (currentSize <= 9) {
                shuffleCount = 3000;
            } else {
                shuffleCount = 5000; // ã¡ã‚‡ãƒ¼ãƒ¤ãƒã¯ç‰¹åˆ¥ã«å¤šã
            }
            
            for (let i = 0; i < shuffleCount; i++) {
                const emptyIndex = puzzleGrid.indexOf(null);
                const possibleMoves = getPossibleMoves(emptyIndex);
                if (possibleMoves.length > 0) {
                    const randomMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                    [puzzleGrid[emptyIndex], puzzleGrid[randomMove]] = [puzzleGrid[randomMove], puzzleGrid[emptyIndex]];
                }
            }
        }

        function getPossibleMoves(emptyIndex) {
            const moves = [];
            const row = Math.floor(emptyIndex / currentSize);
            const col = emptyIndex % currentSize;
            
            if (row > 0) moves.push(emptyIndex - currentSize); // ä¸Š
            if (row < currentSize - 1) moves.push(emptyIndex + currentSize); // ä¸‹
            if (col > 0) moves.push(emptyIndex - 1); // å·¦
            if (col < currentSize - 1) moves.push(emptyIndex + 1); // å³
            
            return moves;
        }

        function renderPuzzle(pieceSize) {
            const container = document.getElementById('puzzle-grid');
            container.innerHTML = '';
            
            puzzleGrid.forEach((piece, index) => {
                const pieceElement = document.createElement('div');
                pieceElement.className = 'puzzle-piece';
                pieceElement.style.width = `${pieceSize}px`;
                pieceElement.style.height = `${pieceSize}px`;
                
                if (piece === null) {
                    pieceElement.classList.add('empty');
                } else {
                    const row = Math.floor(piece / currentSize);
                    const col = piece % currentSize;
                    const bgX = -(col * pieceSize);
                    const bgY = -(row * pieceSize);
                    const totalSize = pieceSize * currentSize;
                    
                    pieceElement.style.backgroundImage = `url(${gameImages[currentPicture]})`;
                    pieceElement.style.backgroundSize = `${totalSize}px ${totalSize}px`;
                    pieceElement.style.backgroundPosition = `${bgX}px ${bgY}px`;
                    
                    pieceElement.onclick = () => movePiece(index);
                    
                    // ã‚¿ãƒƒãƒæ“ä½œå¯¾å¿œ
                    pieceElement.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        movePiece(index);
                    });
                }
                
                container.appendChild(pieceElement);
            });
        }

        function movePiece(clickedIndex) {
            const emptyIndex = puzzleGrid.indexOf(null);
            const possibleMoves = getPossibleMoves(emptyIndex);
            
            if (possibleMoves.includes(clickedIndex)) {
                // ãƒ”ãƒ¼ã‚¹ã‚’ç§»å‹•
                [puzzleGrid[emptyIndex], puzzleGrid[clickedIndex]] = [puzzleGrid[clickedIndex], puzzleGrid[emptyIndex]];
                moves++;
                document.getElementById('moves').textContent = moves;
                
                // ãƒ‘ã‚ºãƒ«ã‚µã‚¤ã‚ºã«å¿œã˜ã¦å†è¨ˆç®—ï¼ˆåˆæœŸåŒ–ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
                const containerPadding = 60;
                const screenWidth = window.innerWidth - containerPadding;
                const screenHeight = window.innerHeight - 300;
                
                let maxSize;
                if (currentSize <= 4) {
                    maxSize = Math.min(screenWidth * 0.85, screenHeight * 0.7, 320);
                } else if (currentSize <= 6) {
                    maxSize = Math.min(screenWidth * 0.90, screenHeight * 0.75, 360);
                } else if (currentSize <= 9) {
                    maxSize = Math.min(screenWidth * 0.95, screenHeight * 0.8, 380);
                } else {
                    maxSize = Math.min(screenWidth * 0.98, screenHeight * 0.85, 400);
                }
                
                const pieceSize = Math.floor(maxSize / currentSize);
                renderPuzzle(pieceSize);
                
                // ã‚¯ãƒªã‚¢ãƒã‚§ãƒƒã‚¯
                if (checkWin()) {
                    setTimeout(showClear, 500);
                }
            }
        }

        function checkWin() {
            for (let i = 0; i < puzzleGrid.length - 1; i++) {
                if (puzzleGrid[i] !== i) return false;
            }
            return puzzleGrid[puzzleGrid.length - 1] === null;
        }

        function showClear() {
            document.getElementById('final-moves').textContent = moves;
            // å®Œæˆã‚¤ãƒ©ã‚¹ãƒˆã‚’è¡¨ç¤º
             document.getElementById('completed-image').style.backgroundImage = `url(${gameImages[currentPicture]})`;
            console.log('å®Œæˆç”»åƒè¨­å®š:', currentPicture, gameImages[currentPicture] ? 'ç”»åƒã‚ã‚Š' : 'ç”»åƒãªã—');
            console.log('completed-imageè¦ç´ :', document.getElementById('completed-image'));
    console.log('currentPictureå€¤:', currentPicture);
    console.log('gameImagesé…åˆ—:', gameImages.length, 'å€‹ã®ç”»åƒ');
    if (gameImages[currentPicture]) {
        console.log('ç”»åƒãƒ‡ãƒ¼ã‚¿ã®æœ€åˆã®éƒ¨åˆ†:', gameImages[currentPicture].substring(0, 50));
    }
            
            // æ„Ÿè¬ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨å†™çœŸæä¾›è€…ã‚’è¡¨ç¤º
            const currentImageDetail = imageDetails[currentPicture];
            if (currentImageDetail) {
                document.getElementById('thank-you-message').textContent = currentImageDetail.message;
                
                // å†™çœŸæä¾›è€…ã‚’è¡¨ç¤ºï¼ˆã€Œèª°ã€…ã‚ˆã‚Šã€å½¢å¼ï¼‰
                const titleElement = document.getElementById('picture-title');
                if (currentImageDetail.type === 'friend') {
                    titleElement.innerHTML = `${currentImageDetail.provider}<span style="font-size: 14px;">ã‚ˆã‚Š</span>`;
                } else {
                    titleElement.innerHTML = `ã‚ãã‚‰<span style="font-size: 14px;">ã‚ˆã‚Š</span>`;
                }
            } else {
                document.getElementById('thank-you-message').textContent = 'éŠã‚“ã§ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ï¼';
                document.getElementById('picture-title').innerHTML = `ã‚ãã‚‰<span style="font-size: 14px;">ã‚ˆã‚Š</span>`;
            }
                        
            // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢æƒ…å ±ã‚’ä¿å­˜
            const stageKey = `${currentPicture}-${currentSize}`;
            if (!clearedStages.includes(stageKey)) {
                clearedStages.push(stageKey);
                saveGameData();
            }
            
           // ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ç„¡åŠ¹åŒ–ï¼ˆå…¨çµµæŸ„ãŒæœ€åˆã‹ã‚‰åˆ©ç”¨å¯èƒ½ï¼‰
            // checkAndUnlockNewPicture();
            
            // ç´™å¹é›ªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            createConfetti();
            
            showScreen('clear-screen');
        }
        
        // æ–°ã—ã„çµµæŸ„ã®ã‚¢ãƒ³ãƒ­ãƒƒã‚¯åˆ¤å®šï¼ˆç¾åœ¨ã¯ä½¿ç”¨ã—ãªã„ï¼‰
        function checkAndUnlockNewPicture() {
            const totalImages = imageDetails.length;
            
            // ã¾ã ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„çµµæŸ„ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (unlockedPictures.length < totalImages && Math.random() < 0.7) { // 70%ã®ç¢ºç‡
                const availableImages = [];
                for (let i = 0; i < totalImages; i++) {
                    if (!unlockedPictures.includes(i) && gameImages[i]) {
                        availableImages.push(i);
                    }
                }
                
                if (availableImages.length > 0) {
                    // ãƒ©ãƒ³ãƒ€ãƒ ã«æ–°ã—ã„çµµæŸ„ã‚’ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
                    const newPictureIndex = availableImages[Math.floor(Math.random() * availableImages.length)];
                    unlockedPictures.push(newPictureIndex);
                    saveGameData();
                    
                    // ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    const unlockTitle = `ç”»åƒ ${newPictureIndex + 1}`;
                    document.getElementById('unlock-title').textContent = `ã€Œ${unlockTitle}ã€ãŒã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼`;
                    document.getElementById('unlock-message').style.display = 'block';
                } else {
                    document.getElementById('unlock-message').style.display = 'none';
                }
            } else {
                document.getElementById('unlock-message').style.display = 'none';
            }
        }
        
        // ç´™å¹é›ªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        function createConfetti() {
            const container = document.getElementById('congratulations-container');
            
            // æ—¢å­˜ã®ç´™å¹é›ªã‚’å‰Šé™¤
            const existingConfetti = container.querySelectorAll('.confetti');
            existingConfetti.forEach(confetti => confetti.remove());
            
            // æ–°ã—ã„ç´™å¹é›ªã‚’ä½œæˆ
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    container.appendChild(confetti);
                    
                    // 3ç§’å¾Œã«å‰Šé™¤
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.parentNode.removeChild(confetti);
                        }
                    }, 4000);
                }, i * 50);
            }
        }
        
        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
        function saveGameData() {
            const gameData = {
                unlockedPictures: unlockedPictures,
                clearedStages: clearedStages
            };
            localStorage.setItem('slidepuzzle_gamedata', JSON.stringify(gameData));
        }
        
        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        function loadGameData() {
            try {
                const savedData = localStorage.getItem('slidepuzzle_gamedata');
                if (savedData) {
                    const gameData = JSON.parse(savedData);
                    // ã‚¢ãƒ³ãƒ­ãƒƒã‚¯æƒ…å ±ã¯ä½¿ã‚ãšã€ã‚¯ãƒªã‚¢æƒ…å ±ã®ã¿èª­ã¿è¾¼ã¿
                    clearedStages = gameData.clearedStages || [];
                    console.log('ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆã‚¯ãƒªã‚¢æƒ…å ±ã®ã¿ï¼‰:', gameData);
                }
            } catch (error) {
                console.log('ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                clearedStages = [];
            }
        }

        // ã‚²ãƒ¼ãƒ ç”»é¢ã§ã€ŒCtrl + Shift + Cã€ã‚’æŠ¼ã—ãŸã¨ãã«ã‚¯ãƒªã‚¢ç”»é¢ã«ç›´æ¥ã‚¸ãƒ£ãƒ³ãƒ—
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'C' && document.getElementById('game-screen').classList.contains('active')) {
                moves = Math.floor(Math.random() * 50) + 10; // ãƒ©ãƒ³ãƒ€ãƒ ãªæ‰‹æ•°
                showClear();
            }
        });

        // åˆæœŸåŒ–
        window.onload = function() {
            console.log('ã‚²ãƒ¼ãƒ é–‹å§‹ - ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒã‚’èª­ã¿è¾¼ã¿ä¸­...');
            
            // åˆæœŸçŠ¶æ…‹ã§ã‚¿ã‚¤ãƒˆãƒ«èƒŒæ™¯ã‚’å¼·åˆ¶çš„ã«è¨­å®š
            const body = document.body;
            body.className = ''; // æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚’ã‚¯ãƒªã‚¢
            body.classList.add('title-background');
            console.log('ã‚¿ã‚¤ãƒˆãƒ«èƒŒæ™¯ã‚’è¨­å®š:', body.className);
            console.log('bodyã‚¯ãƒ©ã‚¹ä¸€è¦§:', body.classList);
            
            loadGameData(); // ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            loadLocalImages();
        }
    </script>
</body>
</html>
